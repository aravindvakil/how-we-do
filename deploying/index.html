<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.2.1"><title>Deploying - Wakeflow</title><link rel=stylesheet href=../assets/stylesheets/main.e8d9bf0c.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#how-we-deploy class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Wakeflow class="md-header__button md-logo" aria-label=Wakeflow data-md-component=logo> <img src=../images/favicon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Wakeflow </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deploying </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/wakeflow/how-we-do/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Wakeflow class="md-nav__button md-logo" aria-label=Wakeflow data-md-component=logo> <img src=../images/favicon.png alt=logo> </a> Wakeflow </label> <div class=md-nav__source> <a href=https://github.com/wakeflow/how-we-do/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../trainingMaterials/ class=md-nav__link> Train </a> </li> <li class=md-nav__item> <a href=../holidays/ class=md-nav__link> Holidays </a> </li> <li class=md-nav__item> <a href=../progression/ class=md-nav__link> Progression </a> </li> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../dotfiles/ class=md-nav__link> Dotfiles </a> </li> <li class=md-nav__item> <a href=../javascript/ class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../testing/ class=md-nav__link> Testing </a> </li> <li class=md-nav__item> <a href=../validation/ class=md-nav__link> Validation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Deploying <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Deploying </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-branch-out class=md-nav__link> 1. Branch out </a> </li> <li class=md-nav__item> <a href=#2-pull-request class=md-nav__link> 2. Pull Request </a> </li> <li class=md-nav__item> <a href=#3-code-owner-review class=md-nav__link> 3. Code Owner Review </a> </li> <li class=md-nav__item> <a href=#4-rebase class=md-nav__link> 4. Rebase </a> </li> <li class=md-nav__item> <a href=#5-notify-on-slack class=md-nav__link> 5. Notify on Slack </a> </li> <li class=md-nav__item> <a href=#6-merge class=md-nav__link> 6. Merge </a> </li> <li class=md-nav__item> <a href=#7-smoke-test class=md-nav__link> 7. Smoke test </a> </li> <li class=md-nav__item> <a href=#8-clean-up-branches class=md-nav__link> 8. Clean up branches </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> Questions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cicd/ class=md-nav__link> CI/CD </a> </li> <li class=md-nav__item> <a href=../firestore_backups/ class=md-nav__link> Firestore Backups </a> </li> <li class=md-nav__item> <a href=../event_tracking/ class=md-nav__link> Event Tracking </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-branch-out class=md-nav__link> 1. Branch out </a> </li> <li class=md-nav__item> <a href=#2-pull-request class=md-nav__link> 2. Pull Request </a> </li> <li class=md-nav__item> <a href=#3-code-owner-review class=md-nav__link> 3. Code Owner Review </a> </li> <li class=md-nav__item> <a href=#4-rebase class=md-nav__link> 4. Rebase </a> </li> <li class=md-nav__item> <a href=#5-notify-on-slack class=md-nav__link> 5. Notify on Slack </a> </li> <li class=md-nav__item> <a href=#6-merge class=md-nav__link> 6. Merge </a> </li> <li class=md-nav__item> <a href=#7-smoke-test class=md-nav__link> 7. Smoke test </a> </li> <li class=md-nav__item> <a href=#8-clean-up-branches class=md-nav__link> 8. Clean up branches </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> Questions </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/wakeflow/how-we-do/edit/master/docs/deploying.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=how-we-deploy>How we deploy</h1> <p>When deploying a change to one of our repo's master branch we follow the following steps:</p> <h2 id=1-branch-out>1. Branch out</h2> <p>When making a change to any codebase on wakeflow's repos, the first step is to create a branch that will contain the change.</p> <p>Branch naming: The branch name should start with your initials, so that anyone can tell who created the branch. If I (Andreas Kater) wanted to update the CSS styling on our website, I'd create a branch called ak/css-updates with the command <code>gbo ak/css-updates</code> (install our dotfiles to get access to shortcuts like <code>gbo</code> <a href=/dotfiles.md>here</a>).</p> <p>I would then commit my changes to this branch.</p> <h2 id=2-pull-request>2. Pull Request</h2> <p>When the change is complete, we submit a pull request. The easiest way to do that is to checkout the branch with <code>gc ak/css-updates</code> and then create the PR with <code>gpr</code>.</p> <h2 id=3-code-owner-review>3. Code Owner Review</h2> <p>Every PR needs to be reviewed by a code owner of the repo. Github is configured in such a way that merging is not possible until this has taken place.</p> <h2 id=4-rebase>4. Rebase</h2> <p>Once you have approval from at least one other team member, you rebase your changes.</p> <p>This basically squashes all commits you have on your branch into a single one, so that the master branch only has one commit for all the changes you made on your branch. This keeps the git history of our master branch clean and easy to understand.</p> <p>For example, in updating the CSS on our website, I might have made the following 3 commits:</p> <p><img alt="Three commits" src=../images/three-commits.png></p> <p>Those commits are useful while I'm working on the branch, but in our master branch's git history we don't need that level of detail. We want a single message there, that tells us what happened at a higher level: <code>ak/css-updates</code>. This message is usually the branch name.</p> <p>To rebase: 1. <code>grbi origin/master</code> and then follow the instructions. 2. You should see someting like:</p> <pre><code>`pick 52a18f6 updated deploying.md`

`pick 35a32e9 updated images`

`pick b003d67 updates merge instructions`
</code></pre> <ol> <li> <p>Typically you'll want to edit this file like so:</p> <p><code>r 52a18f6 updated deploying.md</code> &lt;- the <code>r</code> stands for reword and lets you rename your commit message</p> <p><code>f 35a32e9 updated images</code> &lt;- the <code>f</code> stands for fixup and lets you incorporate these changes into the commit above, so that there is only one commit message</p> <p><code>f b003d67 updates merge instructions</code></p> </li> </ol> <h2 id=5-notify-on-slack>5. Notify on Slack</h2> <p>Once we have got approval from a code owner to merge, we notify the rest of the team on Slack.</p> <p>To do this, we send a message to the <code>#deploy</code> channel with the url of the PR we are about to merge, like so:</p> <p><img alt="PR on slack" src=../images/slack-pr.png></p> <p>When we merge in our changes on Github, Github Actions make sure that our code is deployed automatically.</p> <p>Therefore before merging, we want to make sure the team is alerted to the fact that a deploy is about to take place in case anything goes wrong and the rest of the team needs to step in to help.</p> <h2 id=6-merge>6. Merge</h2> <p>Once you have notified the team you can merge the PR.</p> <ol> <li>Check the git history is linear, by running <code>gl</code>. You should see someting like this:</li> </ol> <p><img alt="Linear Git History" src=../images/linear-history.png></p> <ol> <li>Check your branch is exactly one commit ahead of <code>master</code>. If not, rebase as explained above.</li> <li>Check out the master branch with <code>gc master</code></li> <li>Run <code>git merge ak/css-updates</code></li> </ol> <h2 id=7-smoke-test>7. Smoke test</h2> <p>After rebasing and merging, we make sure that the deploy completes successfully, by watching the github actions complete.</p> <p>Once the Github Actions have successfully completed, we do a smoke test of the application, to: 1. make sure everything works as expected 2. make sure your changes are now live</p> <h2 id=8-clean-up-branches>8. Clean up branches</h2> <p>Now that the change has been successfully deployed, we no longer need the feature branch. Therefore we delete it, both locally and remotely, using the command <code>gdbb ak/css-updates</code> (gdbb stands for git delete both branches).</p> <p>Run <code>gl</code> to check your feature branch is no longer there.</p> <p>Success! You're done.</p> <h2 id=questions>Questions</h2> <p>If you have any questions about this process, just slack Andi.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../validation/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Validation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Validation </div> </div> </a> <a href=../cicd/ class="md-footer__link md-footer__link--next" aria-label="Next: CI/CD" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> CI/CD </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.bd0b6b67.min.js"}</script> <script src=../assets/javascripts/bundle.8aa65030.min.js></script> </body> </html>